<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Tobias Dienlin" />


<title>Power Analysis</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="power_analysis.html">Power Analyses</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tdienlin/Persistence_Identification">
    <span class="fa fa-lg fa-github"></span>
     
    Source Code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Power Analysis</h1>
<h4 class="author">Tobias Dienlin</h4>

</div>


<pre class="r"><code>library(broom)
library(ggplot2)
library(magrittr)
library(tidyverse)</code></pre>
<div id="background" class="section level1">
<h1>Background</h1>
<p>Here, I run some power analysis for a study on online political participation. In the study, people use a social networking site (discord) on which they discuss political matters. On discord, people will participate in a group of 20 people (medium scale group communication). The dependent variable is how much people discuss (measured via <em>number of words</em>). We’re interested how different SNS designs affect communication.</p>
<p>The study design is as follows:</p>
<ul>
<li>The website is experimentally manipulated (2 x 2 design).</li>
<li>First, the <em>persistence</em> of the comments is manipulated (permanent vs. ephemeral), as well as <em>identification</em> (identifiable vs. anonymous).</li>
<li>To increase generalizability, the groups will discuss one of three <em>topics</em>: corona politics, environment, gender.</li>
</ul>
<p>So these are 2 (identification) x 2 (persistence) experimental factors and a 3-way generalization factor (topic), resulting in a minimum of 12 groups. Hence, the minimum sample size 12 x 20 = 240 participants.</p>
<p>To calculate power, the question now is how often do we need to <em>repeat</em> this design to achieve sufficient power? Once, twice, thrice, etc? Hence, the factor to change/affect power is <em>repetition</em>, ranging from 1 to 10.</p>
</div>
<div id="custom-functions" class="section level1">
<h1>Custom functions</h1>
<pre class="r"><code>generate_design &lt;- function(groupsize, 
                            persis, 
                            ident, 
                            topics, 
                            repetition, 
                            ...){
  
  # function generates underlying (empty) datastructure
  
  # count number of groups
  groups &lt;- persis * ident * topics * repetition
  
  # make datastructure
  expand.grid(
    participant = 1:groupsize, 
    persistence = 1:persis - 1, # -1 to make binary
    identification = 1:ident - 1, 
    topic = 1:topics,
    repetition = 1:repetition) %&gt;% 
    as.data.frame() %&gt;% 
    rownames_to_column(&quot;id&quot;) %&gt;% 
    mutate(
      group = rep(c(1:groups), each = groupsize))
}

sim_d &lt;- function(d_frame, 
                  seed, # make results reproducible
                  effects, # vector of effects we anticipate
                  sd, 
                  groupsize, 
                  ...){
  
  # function to simulate data

  # set.seed(seed)  # uncomment to make results reproducible
  
  # compute how many participants per cell (exp. condition)
  n_cell &lt;- groupsize_n * topics_n * repetition_n
  
  # create the DV. 
  # For now, this will be standardized, bc. of lack of concrete data

  # version 1: if-else # produces weird results
  # d_frame %&lt;&gt;%
  #   mutate(words = 
  #     ifelse(persistence == 0 &amp; identification == 0, rnorm(n_cell, effects[&quot;pers0_iden_0_m&quot;], sd),
  #        ifelse(persistence == 0 &amp; identification == 1, rnorm(n_cell, effects[&quot;pers0_iden_1_m&quot;], sd),
  #            ifelse(persistence == 1 &amp; identification == 0, rnorm(n_cell, effects[&quot;pers1_iden_0_m&quot;], sd),
  #                rnorm(n_cell, effects[&quot;pers1_iden_1_m&quot;], sd))))
  #          )
  
  # version 2: filter
  d_frame$words &lt;- 999
  for(i in 1 : repetition_n) {
    d_frame[d_frame$persistence == 0 &amp; d_frame$identification == 0 &amp; d_frame$repetition == i, ]$words &lt;- 
      rnorm(groupsize_n, effects[&quot;pers0_iden_0_m&quot;], sd)
    d_frame[d_frame$persistence == 0 &amp; d_frame$identification == 1 &amp; d_frame$repetition == i, ]$words &lt;- 
      rnorm(groupsize_n, effects[&quot;pers0_iden_1_m&quot;], sd)
    d_frame[d_frame$persistence == 1 &amp; d_frame$identification == 0 &amp; d_frame$repetition == i, ]$words &lt;- 
      rnorm(groupsize_n, effects[&quot;pers1_iden_0_m&quot;], sd)
    d_frame[d_frame$persistence == 1 &amp; d_frame$identification == 1 &amp; d_frame$repetition == i, ]$words &lt;- 
      rnorm(groupsize_n, effects[&quot;pers1_iden_1_m&quot;], sd)
  }
    
  return(d_frame)
}

analyze_d &lt;- function(object, ...) {

  # function to analyze data and to extract results
  
  # get means
  means &lt;- group_by(object, persistence, identification) %&gt;% 
    summarize(mean = mean(words), .groups = &#39;drop&#39;)
  
  # get estimates from regression
  fit &lt;- lm(words ~ persistence + identification, object)
  fit_res &lt;- tidy(fit)
  
  # combine result
  results &lt;- data.frame(
    per0_ide0_m = filter(means, persistence == 0, identification == 0)$mean,
    per0_ide1_m = filter(means, persistence == 0, identification == 1)$mean,
    per1_ide0_m = filter(means, persistence == 1, identification == 0)$mean,
    per1_ide1_m = filter(means, persistence == 1, identification == 1)$mean,
    persistence_est = fit_res[fit_res$term == &quot;persistence&quot;,]$estimate,
    persistence_p = fit_res[fit_res$term == &quot;persistence&quot;,]$p.value,
    identification_est = fit_res[fit_res$term == &quot;identification&quot;,]$estimate,
    identification_p = fit_res[fit_res$term == &quot;identification&quot;,]$p.value,
    n = glance(fit)$nobs
  ) 
  return(results)
}

des_sim_fit &lt;- function(...){
  
  # function to report and extract results
  
  d_frame &lt;- generate_design(...)
  # words &lt;- sim_d(d_frame, ...)
  # d &lt;- cbind(d_frame, words)
  d &lt;- sim_d(d_frame, ...)
  analyze_d(d)
}</code></pre>
</div>
<div id="define-study-design-and-sample-size" class="section level1">
<h1>Define study design and sample size</h1>
<pre class="r"><code># study design
groupsize_n   &lt;- 20
persis_n      &lt;- 2
ident_n       &lt;- 2 
topics_n      &lt;- 3
repetition_n  &lt;- 6

# overall sample size
sample_size &lt;- groupsize_n * persis_n * ident_n * topics_n * repetition_n</code></pre>
<p>We define our study design as follows:</p>
<ul>
<li>20 participants per group</li>
<li>2 persistence conditions</li>
<li>2 identification conditions</li>
<li>3 different topics to be discussed</li>
<li>6 repetitions of this set-up</li>
<li>1440 overall sample size</li>
</ul>
</div>
<div id="create-data-frame" class="section level1">
<h1>Create data frame</h1>
<p>We then create an empty data frame, in which we will then later simulate the data.</p>
<pre class="r"><code># create design frame
d_frame &lt;- generate_design(
  groupsize  = groupsize_n,
  persis     = persis_n,  
  ident      = ident_n,     
  topics     = topics_n,  
  repetition = repetition_n
  )
d_frame</code></pre>
<p>Check if data-frame is alright.</p>
<pre class="r"><code>xtabs(~persistence + identification + topic + repetition, d_frame)</code></pre>
<p>Allocation of participants to experimental groups worked just fine.</p>
</div>
<div id="define-effect-size" class="section level1">
<h1>Define effect size</h1>
<p>We first need to define likely effects. We assume normal distribution, a mean of zero and a standard deviation of one. We can hence think of effects in terms of Cohen’s d: .2 = small, .5 = medium, and .8 = large.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="center">persistent</th>
<th align="center">ephemeral</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>identifiable</td>
<td align="center">-.40</td>
<td align="center">-.20</td>
</tr>
<tr class="even">
<td>anonymous</td>
<td align="center">-.20</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>This should lead to a main effect of persistence of d = -.20 and a main effect of identifiability of d = -.20.</p>
<pre class="r"><code>pers0_iden_0_m &lt;- 0
pers0_iden_1_m &lt;- -.2
pers1_iden_0_m &lt;- -.2
pers1_iden_1_m &lt;- -.4
effects_est &lt;- c(pers0_iden_0_m, pers0_iden_1_m, pers1_iden_0_m, pers1_iden_1_m)
names(effects_est) &lt;- c(&quot;pers0_iden_0_m&quot;, &quot;pers0_iden_1_m&quot;, &quot;pers1_iden_0_m&quot;, &quot;pers1_iden_1_m&quot;)
sd_est &lt;- 1</code></pre>
</div>
<div id="test-run" class="section level1">
<h1>Test run</h1>
<p>Let’s create a single data-set and analyze it.</p>
<pre class="r"><code>d &lt;- sim_d(d_frame, seed = 1, effects_est, sd_est, groupsize_n)</code></pre>
<p>Let’s check if means were created alright:</p>
<pre class="r"><code>means &lt;- d %&gt;% 
  group_by(persistence, identification) %&gt;% 
  summarize(mean = mean(words), .groups = &#39;drop&#39;)
means</code></pre>
<pre><code>## # A tibble: 4 × 3
##   persistence identification     mean
##         &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt;
## 1           0              0 -0.00882
## 2           0              1 -0.197  
## 3           1              0 -0.0403 
## 4           1              1 -0.453</code></pre>
<p>Sample size small and single study, but general tendency seems to be alright.</p>
<p>Let’s also quickly run regression.</p>
<pre class="r"><code>lm(words ~ persistence + identification, d) %&gt;% 
  summary()</code></pre>
<pre><code>## 
## Call:
## lm(formula = words ~ persistence + identification, data = d)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.74332 -0.67846 -0.01185  0.69900  2.59851 
## 
## Coefficients:
##                Estimate Std. Error t value      Pr(&gt;|t|)    
## (Intercept)     0.04731    0.04506   1.050       0.29392    
## persistence    -0.14374    0.05203  -2.763       0.00581 ** 
## identification -0.30054    0.05203  -5.776 0.00000000934 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.9872 on 1437 degrees of freedom
## Multiple R-squared:  0.02774,    Adjusted R-squared:  0.02639 
## F-statistic:  20.5 on 2 and 1437 DF,  p-value: 0.000000001667</code></pre>
<p>Results look reasonable. Both persistence and identification reduce disclosure.</p>
</div>
<div id="power-analysis" class="section level1">
<h1>Power analysis</h1>
<pre class="r"><code>n_sim &lt;- 1000</code></pre>
<p>We run a power analysis with 1000 simulations.</p>
<pre class="r"><code>sims &lt;-
  tibble(sim = 1:n_sim) %&gt;% 
  mutate(
    effect = map(sim, 
                 des_sim_fit, 
                 groupsize = groupsize_n, 
                 persis = persis_n, 
                 ident = ident_n, 
                 topics = topics_n, 
                 repetition = repetition_n, 
                 effects = effects_est, 
                 sd = sd_est)
    ) %&gt;%
  unnest(effect) %&gt;%
  as.data.frame()
sims</code></pre>
<p>We visualize the results. First persistence:</p>
<pre class="r"><code>ggplot(sims) +
  geom_point(aes(sim, persistence_est, color = persistence_p &lt; .05)) + 
  scale_color_manual(values = c(&quot;grey&quot;, &quot;blue2&quot;))</code></pre>
<p><img src="power_analysis_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Then identification.</p>
<pre class="r"><code>ggplot(sims) +
  geom_point(aes(sim, identification_est, color = identification_p &lt; .05)) + 
  scale_color_manual(values = c(&quot;grey&quot;, &quot;blue2&quot;))</code></pre>
<p><img src="power_analysis_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>We compute average effect size.</p>
<pre class="r"><code>apply(sims[c(&quot;per0_ide0_m&quot;, &quot;per0_ide1_m&quot;, &quot;per1_ide0_m&quot;, &quot;per1_ide1_m&quot;)], 2, mean)</code></pre>
<pre><code>##  per0_ide0_m  per0_ide1_m  per1_ide0_m  per1_ide1_m 
## -0.003559893 -0.202056583 -0.197057465 -0.399849369</code></pre>
<p>We compute power.</p>
<pre class="r"><code>power &lt;- data.frame(
  persistence = sum(sims$persistence_p &lt; .05 &amp; sims$persistence_est &lt; 0) / n_sim,
  identification = sum(sims$identification_p &lt; .05 &amp; sims$identification_est &lt; 0) / n_sim
)
print(power)</code></pre>
<pre><code>##   persistence identification
## 1        0.86          0.846</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
